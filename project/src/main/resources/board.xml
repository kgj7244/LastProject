<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace xml을 구별하기 위한 이름 -->
<!-- resultMap는 table에 컬럼명과 class에 dept변수명이 다를 때 mapping하는 용도 -->
<mapper namespace="boardns">
	<!-- <select id="getTotal" resultType="integer">
		select count(*) from board
	</select> --> 
	<!-- 테이블로부터 데이터를 추출하는 조건 값이 있으면 where 없으면 where 안생김 -->
	<!-- #와 $의 차이는 $는 컬럼명(DB안에 있는 컬럼명?) #은 입력한 값이 들어옴 -->
	<select id="getTotal" parameterType="board" resultType="integer">
		select count(*) from board	
		<where> <!-- 테이블로부터 데이터를 추출하는 조건 값이 있으면 where 없으면 where 안생김 -->
			<if test="keyword !=null and keyword !=''">
			<!-- #와 $의 차이는 $는 컬럼명(DB안에 있는 컬럼명?) #은 입력한 값이 들어옴 -->
				<if test="search=='subcon'">
					subject like '%'||#{keyword}||'%' or content like '%'||#{keyword}||'%'
				</if>
				<if test="search!='subcon'">
					${search} like '%'||#{keyword}||'%' 
				</if>
			</if>
		</where>
	</select>
	
	<!-- <select id="list" parameterType="map" resultType="board">
	a는 in_line view 전체를 table로 보고 붙인 별칭, a.*는 inline_view 모든 데이터
		select * 
		from (select a.*, rownum rn from (select * from board order by ref desc, re_step) a) 
		where rn between #{startRow} and #{endRow}
	</select> -->
	<select id="list" parameterType="board" resultType="board">
	<!-- a는 in_line view 전체를 table로 보고 붙인 별칭, a.*는 inline_view 모든 데이터-->
	<!-- $는 컬럼명, # 값 -->
		select * 
		from (select a.*, rownum rn from (select * from board 
		<where> <!-- 테이블로부터 데이터를 추출하는 조건 값이 있으면 where 없으면 where 안생김 -->
			<if test="keyword !=null and keyword !=''">
			<!-- #와 $의 차이는 $는 컬럼명(DB안에 있는 컬럼명?) #은 입력한 값이 들어옴 -->
				<if test="search=='subcon'">
					subject like '%'||#{keyword}||'%' or content like '%'||#{keyword}||'%'
				</if>
				<if test="search!='subcon'">
					${search} like '%'||#{keyword}||'%' 
				</if>
			</if>
		</where>
		 order by ref desc, re_step) a) 
		where rn between #{startRow} and #{endRow}
	</select>
	<update id="updateReadCount" parameterType="integer">
		update board set readcount=readcount+1 where num=#{num}
	</update>
	<select id="select" parameterType="integer" resultType="board">
		select * from board where num=#{num} 
	</select>
	<select id="maxNum" resultType="integer">
		select nvl(max(num), 0) +1 from board
	</select>
	<insert id="insert" parameterType="board">
		insert into board values(#{num},#{writer},#{subject},#{content},#{email},0,#{password},#{ref},#{re_step},#{re_level},#{ip},sysdate,'n')
	</insert>
	<update id="update" parameterType="board">
		update board set writer=#{writer}, subject=#{subject}, email=#{email}, content=#{content} where num=#{num}
	</update>
	<update id="delete" parameterType="integer">
		update board set del='y' where num=#{num}
	</update>
	<update id="updateStep" parameterType="board">
		update board set re_step=re_step+1 where ref=#{ref} and re_step > #{re_step}
	</update>
</mapper>